10 DIM R1(96), R2(96), R3(96), RP(96), RC(3)
20 GOSUB 20000
30 INPUT A$: B$="": IF A$="" THEN 260
40 FOR N=1 TO LEN(A$)
50 I$=MID$(A$,N,1)
60 I = ASC(I$)-32
65 IF I < 0 THEN PRINT I$: GOTO 130
70 GOSUB 10010: GOSUB 10110: GOSUB 10210: GOSUB 10310
80 GOSUB 10220: GOSUB 10120: GOSUB 10020
90 GOSUB 10060
100 IF RC(1) = I2 THEN GOSUB 10160: RC(1) = 0
110 IF RC(2) = I3 THEN GOSUB 10260: RC(2) = 0
120 B$=B$+CHR$(I+32)
130 NEXT N
250 PRINT B$: GOTO 30
260 END
10000 REM Rotor 1
10010 I = R1(I): RETURN
10020 FOR X = 0 to 96
10030 IF R1(X) = I THEN I=X: RETURN
10040 NEXT X
10050 RETURN
10060 RC(1)=RC(1)+1:C = R1(0)
10070 FOR X=0 TO 94:R1(X)=R1(X+1):NEXT X
10080 R1(95)=C:RETURN
10100 REM Rotor 2
10110 I = R2(I): RETURN
10120 FOR X = 0 to 96
10130 IF R2(X) = I THEN I=X: RETURN
10140 NEXT X
10150 RETURN
10160 RC(2)=RC(2)+1:C = R2(0)
10170 FOR X=0 TO 94:R2(X)=R2(X+1):NEXT X
10180 R2(95)=C:RETURN
10200 REM Rotor 3
10210 I = R3(I): RETURN
10220 FOR X = 0 to 96
10230 IF R3(X) = I THEN I=X: RETURN
10240 NEXT X
10250 RETURN
10260 RC(3)=RC(3)+1:C = R3(0)
10270 FOR X=0 TO 94:R3(X)=R3(X+1):NEXT X
10280 R3(95)=C:RETURN
10300 REM Reflector
10310 P=I:P=P+48:IF P > 95 THEN P=P-96
10320 I=P: RETURN
10400 REM Plugboard
10410 I = RP(I): RETURN
19999 REM Initialize
20000 FOR X=0 TO 95: READ R1(X): NEXT X
20010 FOR X=0 TO 95: READ R2(X): NEXT X
20020 FOR X=0 TO 95: READ R3(X): NEXT X
20030 I1=10:I2=15:I3=5:RC(1)=0:RC(2)=0:RC(3)=0
20040 RETURN
21010 DATA 85,37,15,14,19,95, 5, 1,36,81,77,28,83,44,61, 6,30,18,65,52
21011 DATA 51,59,33,47,68,79,16,34,41,49,69,45,21,32,63,75,10,29,27,66
21012 DATA 89,20,62, 2,55,80,74,91,58,24,88,12, 0, 9,22,71,57,17, 3,11
21013 DATA 39,72,73,26,56,43,76, 7,86, 4,42,54,35,67,46,50,78, 8,31,84
21014 DATA 38,82,94,93,25,40,13,48,92,87,64,60,90,23,70,53
21020 DATA 89,36,73,65,26,28, 2,46,33, 9,42,45,30,20,66,51,84,64,71,32
21021 DATA  1, 3,27,91,50, 8,57,88, 7, 0,83,31,94,15, 4,59, 6,24,17,40
21022 DATA 10,86,54,68,61,58,41,78,22,55,90,19,93,79,39,69,49,35,75,34
21023 DATA 23,95,80,25,70,47,48,56,82,87,38,11,18,16,60,72,74,21, 5,63
21024 DATA 52,76,92,62,81,53,85,12,14,67,13,37,29,77,44,43
21030 DATA 37,63,35,70,52,13,28,41, 7,81,48,29, 4,76,16,59,19,80,36,92
21031 DATA 31,50,83,47,68,45,89,20,22,11,84,77,72,30,49,86, 3,64,38,71
21032 DATA 94,82,69,39, 8,58,74, 1,27,15, 2,90,34,53,46, 6,33,67,60,79
21033 DATA 75, 5,56,44,87,88,21,14,95,23,10,55,24,32,66,91,42,18,93,12
21034 DATA 25,78,17, 0,57,61,26, 9,54,51,73,65,85,40,62,43
20120 PRINT "Rotor1   =";:FOR X=0 TO 96:PRINT R1(X);:NEXT X:PRINT
20130 PRINT "Rotor2   =";:FOR X=0 TO 96:PRINT R2(X);:NEXT X:PRINT
20140 PRINT "Rotor3   =";:FOR X=0 TO 96:PRINT R3(X);:NEXT X:PRINT
20150 PRINT "Plugboard=";:FOR X=0 TO 96:PRINT RP(X);:NEXT X:PRINT
30000 FOR I1=1 TO LEN(B$)
30010 PRINT ASC(MID$(B$,I1,1));
30020 NEXT I1:PRINT:RETURN
